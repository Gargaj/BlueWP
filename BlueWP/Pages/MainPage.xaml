<Page
    x:Class="BlueWP.Pages.FeedPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:BlueWP.Pages"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:i="using:Microsoft.Xaml.Interactivity"
    xmlns:c="using:Microsoft.Xaml.Interactions.Core" 
    xmlns:controls="using:Microsoft.Toolkit.Uwp.UI.Controls"
    xmlns:bwpc="using:BlueWP.Controls"
    xmlns:bwpi="using:BlueWP.Inlays"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
  <Page.Resources>
    <ResourceDictionary>
      <ResourceDictionary.MergedDictionaries>
        <ResourceDictionary Source="/Styles/FeedPagePivotStyle.xaml"/>
      </ResourceDictionary.MergedDictionaries>
    </ResourceDictionary>
  </Page.Resources>
  
  <Grid>
    <Pivot Style="{StaticResource FeedPagePivotStyle}">

      <!-- Home -->
      <PivotItem>
        <PivotItem.Header>
          <bwpc:FeedPagePivotHeader Glyph="&#xE80F;" Label="Home"/>
        </PivotItem.Header>

        <Grid>
          <Grid.RowDefinitions>
            <RowDefinition Height="40"/>
            <RowDefinition Height="*"/>
          </Grid.RowDefinitions>
          <Button Grid.Row="0" Click="Refresh_Click">
            <Button.Template>
              <ControlTemplate>
                <TextBlock Grid.Row="0" FontWeight="Bold" FontSize="20" Margin="0,0,0,10">Timeline</TextBlock>
              </ControlTemplate>
            </Button.Template>
          </Button>

          <ListView Grid.Row="1" ItemsSource="{Binding FeedItems}" HorizontalContentAlignment="Stretch">
            <ListView.ItemContainerStyle>
              <Style TargetType="ListViewItem">
                <Setter Property="Padding" Value="0"/>
                <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
              </Style>
            </ListView.ItemContainerStyle>
            <ListView.ItemTemplate>
              <DataTemplate>
                <bwpc:Post PostData="{Binding}"/>
              </DataTemplate>
            </ListView.ItemTemplate>
          </ListView>
        </Grid>
          
      </PivotItem>

      <!-- Notifications -->
      <PivotItem>
        <PivotItem.Header>
          <Grid>
            <bwpc:FeedPagePivotHeader Glyph="&#xEA8F;" Label="Notifications"/>
            <Canvas>
              <Border Canvas.Left="60" Canvas.Top="12" Background="Red" Width="16" Height="16" CornerRadius="8" Visibility="Collapsed">
                <i:Interaction.Behaviors>
                  <c:DataTriggerBehavior Binding="{Binding UnreadNotificationCount}" Value="0">
                    <c:ChangePropertyAction PropertyName="Visibility" Value="Collapsed" />
                  </c:DataTriggerBehavior>
                  <c:DataTriggerBehavior Binding="{Binding UnreadNotificationCount}" Value="0" ComparisonCondition="NotEqual">
                    <c:ChangePropertyAction PropertyName="Visibility" Value="Visible" />
                  </c:DataTriggerBehavior>
                </i:Interaction.Behaviors>
                <TextBlock Text="{Binding UnreadNotificationCount}" TextAlignment="Center" Foreground="White" FontSize="10"/>
              </Border>
            </Canvas>
          </Grid>
        </PivotItem.Header>
      </PivotItem>

      <!-- Post -->
      <PivotItem>
        <PivotItem.Header>
          <bwpc:FeedPagePivotHeader Glyph="&#xE70F;" Label="Post"/>
        </PivotItem.Header>
      </PivotItem>

      <!-- Settings -->
      <PivotItem>
        <PivotItem.Header>
          <bwpc:FeedPagePivotHeader Glyph="&#xE713;" Label="Settings"/>
        </PivotItem.Header>
        <bwpi:SettingsInlay />
      </PivotItem>
    </Pivot>

    <!-- modals -->
    <Canvas x:Name="RootCanvas">

      <!-- progress spinner -->
      <Grid Width="{Binding ActualWidth, ElementName=RootCanvas}" 
                Height="{Binding ActualHeight, ElementName=RootCanvas}"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Canvas.ZIndex="5">
        <ProgressRing Width="64" Height="64" IsActive="{Binding IsLoading}"/>
      </Grid>

      <!-- error popup -->
      <Grid Width="{Binding ActualWidth, ElementName=RootCanvas}" 
                Height="{Binding ActualHeight, ElementName=RootCanvas}"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Canvas.ZIndex="10">
        <Border Width="300" Height="100" Background="Red" CornerRadius="10,10,10,10">
          <i:Interaction.Behaviors>
            <c:DataTriggerBehavior Binding="{Binding HasError}" Value="True">
              <c:ChangePropertyAction PropertyName="Visibility" Value="Visible" />
            </c:DataTriggerBehavior>
            <c:DataTriggerBehavior Binding="{Binding HasError}" Value="False">
              <c:ChangePropertyAction PropertyName="Visibility" Value="Collapsed" />
            </c:DataTriggerBehavior>
          </i:Interaction.Behaviors>
          <TextBlock TextAlignment="Center" VerticalAlignment="Center" Foreground="White" TextWrapping="WrapWholeWords" Text="{Binding ErrorText}"/>
        </Border>
      </Grid>
    </Canvas>
  </Grid>
</Page>
